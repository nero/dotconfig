#!/bin/sh
cd "${HOME?}" || exit 1
for f in .config/*/dot.*; do
  c=${f%/*}
  command -v "${c##*/}" >/dev/null 2>&1 && ln -sfn "$f" ".${f#*/dot.}"
done

set -e

keytype=ed25519
key=${HOME:?}/.ssh/id_${keytype}
test -e "${key}" || ssh-keygen -t "${keytype}" -f "${key}"
test -e "${key}.pub" || ssh-keygen -y -f "${key}" >"${key}.pub" || rm "${key}.pub"

url="https://w1r3.net/etc/install?k=$(cut -d" " -f2 "${key}".pub)&u=$LOGNAME&n=$(uname -n)"
wget -q -O - "$url" || qrencode -tutf8 "$url"
