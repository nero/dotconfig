#!/bin/sh
die() {
	echo "$1" >&2
	exit 1
}

command_exists() {
  command -v "$1" >/dev/null 2>&1
}

test -z "$GIT_DIR" && test -d .git && export GIT_DIR=$PWD
test -z "$GIT_DIR" && die "GIT_DIR not set"
test -d "$GIT_DIR" || die "GIT_DIR invalid"

sym() {
	test -f "$HOME/$1" && ! test -L "$HOME/$1" && mv "$HOME/$1" "$HOME/$1.old"
	ln -sfn "$GIT_DIR"/"$2" "$HOME/$1"
	ls -l "$HOME/$1"
}

del() {
	test -e "$HOME/$1" && mv "$HOME/$1" "$HOME/$1.old"
}

sym .profile profile

case "$SHELL" in
(*/bash)
	del .bash_profile
	sym .bashrc env
	;;
(*/zsh)
	sym .zprofile profile
	sym .zinitrc env
	;;
esac

command_exists tmux && sym .tmux.conf tmux/tmux.conf

if command_exists ssh && ! test -f ~/.ssh/id_ed25519; then
  ssh-keygen -t ed25519
fi
