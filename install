#!/bin/sh
die() {
	echo "$1" >&2
	exit 1
}

command_exists() {
  command -v "$1" >/dev/null 2>&1
}

sym() {
	test -f "$1" && ! test -L "$1" && mv "$1" "$1.old"
	ln -sfn "$GIT_DIR"/"$2" "$1"
}

del() {
	test -e "$1" && mv "$1" "$1.old"
}

test -z "$GIT_DIR" && test -d .git && export GIT_DIR=$PWD
test -z "$GIT_DIR" && die "GIT_DIR not set"
test -d "$GIT_DIR" || die "GIT_DIR invalid"

cd "$HOME"
GIT_DIR=${GIT_DIR#$HOME/}

ln -sfn ../../install "$GIT_DIR"/.git/hooks/post-checkout

sym .profile profile

case "$SHELL" in
(*/bash)
	del .bash_profile
	del .bash_logout
	sym .bashrc env
	;;
(*/zsh)
	sym .zprofile profile
	sym .zinitrc env
	;;
esac

command_exists tmux && sym .tmux.conf tmux/tmux.conf
