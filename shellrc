# Config for interactive shells
# If bash is the login shell, .bashrc is a symlink to this file
# If zsh is the login shell, .zshrc is a symlink to this file
# Otherwise its invoked via $ENV, without symlinks, as defined in POSIX

# If bash is your login shell, and you run rsync or git push onto this machine,
# bash will see the $SSH_* variables and will load bashrc despite not being
# an interactive shell. The startup messages then fuck up the git transfer.
# This code bails out if shell is not interactive.
case "$-" in
 (*i*) ;;
 (*) return;;
esac

# Fixes to make bash and zsh behave somewhat similar
if [ -n "$BASH_VERSION" ]; then
  shopt -s checkwinsize
elif [ -n "$ZSH_VERSION" ]; then
  setopt PROMPT_SUBST autolist noautomenu
  unsetopt menucomplete nomatch beep
fi

# load drop-ins
for f in "$ENV".d/*; do
  [ -e "$f" ] && . "$f"
done

slformat="$(
  case "$TERM" in
  (screen*|tmux*|xterm*)
    printf '%s' "\033]0;%s\007"
    ;;
  (*) (
      tput tsl || return
      printf '%%s'
      tput fsl
    ) 2>/dev/null | sed 's/\x1B/\\033/g;s/\x07/\\007/g'
    ;;
  esac
)"

PS1='${PWD##*/}# '

test -n "$slformat" && PS1="\$(printf '$slformat' \"\${PWD##*/} - \${USER}@\${HOSTNAME}\" >&2)$PS1"

unset f slformat
