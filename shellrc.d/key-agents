[ -n "$XDG_RUNTIME_DIR" ] && [ -z "$debian_chroot" ] &&
{
  export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR"/ssh-agent.sock
  ssh-add -L
  if [ "$?" = "2" ]; then
    rm -f "$SSH_AUTH_SOCK"
    eval $(ssh-agent -a "$SSH_AUTH_SOCK")
    echo "$SSH_AGENT_PID" > "$XDG_RUNTIME_DIR"/ssh-agent.pid
  fi
  unset SSH_AGENT_PID

  gpg-connect-agent /bye
  export GPG_TTY=$(tty)
} > /dev/null 2>&1
