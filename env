# Config for setting up the environment across all sessions/applications

# bash will source this file if its an non-interactive SSH login...
# so lets prevent execution for non-interactive shells
case "$-" in
  (*i*) ;;
  (*) return;;
esac

# instruct whacky shells to follow POSIX expansion rules for PS1
if [ -n "$BASH_VERSION" ]; then
  set -o posix
elif [ -n "$ZSH_VERSION" ]; then
  setopt PROMPT_SUBST PROMPT_BANG autolist noautomenu
  # also unset the whacky autocompletion shit
  unsetopt menucomplete nomatch beep
fi

export VISUAL=$(
  for e in nano mcedit vi vim ed; do
    hash "$e" >/dev/null 2>&1 && echo "$e" && break
  done
)

# color support if available
case "$(ls --help 2>&1)" in
(*--color*) alias ls='ls --color=auto';;
esac
case "$(grep --help 2>&1)" in
(*--color*) alias grep='grep --color=auto';;
esac

# feh stores 's' captures in $PWD per default, which i dont like
alias feh='feh --output-dir "$HOME"'

# usecase: fchanges; do make...; done
alias fchanges='while inotifywait -e close_write .'

# disable .lesshst file
alias less='LESSHISTFILE=- less'

# short prompt with basename of PWD
unset PS1
PS1='${PWD##*/}# '

# window title is written via stderr, so its not included in the output of the evaluation
# this avoids confusing shells about where the cursor currently is
case "$TERM" in
(screen*|tmux*|xterm*|rxvt-*) PS1="\$(printf '\033]0;%s\007' \"\${PWD##*/} - \${USER}@\${HOSTNAME}\" >&2)$PS1";;
esac

# FreeBSD Almquist shell does not do parameter expansion in PS1
# https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=46441
case "$0:$(uname -s)" in
(sh:FreeBSD|-sh:FreeBSD) PS1='\W# '
esac

# load drop-ins
for f in "$ENV".d/*; do
  [ -e "$f" ] && . "$f"
done
unset f
