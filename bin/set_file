#!/bin/sh
tmp="$1.$$"
cat >"$tmp"
# New files will honor access mask in $2
test -n "$2" && chmod "$2" "$tmp"
# Delete if input data is empty
if ! test -s "$tmp"; then
  rm "$tmp"
  set -x
  rm -f "$1"
# Disregard input data if equal to file
elif cmp -s "$tmp" "$1"; then
  set -x
  rm "$tmp"
# Set new contents
else
  test -e "$1" && diff -u "$1" "$tmp"
  set -x
  mv "$tmp" "$1"
fi
