#!/bin/sh
upstream="$1"
name="${upstream%/}"
name="${name##*/}"
name="${name%.git}"

repo="${HOME}/git/${name}.git"

git init --bare "$repo" || exit $?
touch "${repo}/git-daemon-export-ok"

(
  cd "$repo"
  git config remote.origin.url "$upstream"
  git config --replace-all remote.origin.fetch "+refs/heads/*:refs/heads/*"
  git config --add remote.origin.fetch "+refs/tags/*:refs/tags/*"
  git config remote.origin.mirror true
  git fetch -p origin
)

echo "git://$HOSTNAME/$USER/$name.git"
