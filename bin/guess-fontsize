#!/bin/sh
set_font() {
  (
    printf "*.faceSize: %d\n" "$1"
    printf "Rxvt.font: xft:Monospace:size=%d\n" "$1"
  ) | xrdb -merge || fail "xrdb failed"
}

fail() {
  printf "%s: %s\n" "$selfname" "$1" >&2
  exit 1
}

selfname=${0##*/}
reference_fontsize=12
target_cols=100

for prog in xrdb x-terminal-emulator tput; do
  command -v "$prog" >/dev/null 2>&1 || fail "$prog not installed"
done

set_font "$reference_fontsize"

tmpfile=$(mktemp)
x-terminal-emulator -e "tput cols > $tmpfile"
reference_cols=$(cat "$tmpfile")
rm "$tmpfile"

test -n "$reference_cols" || fail "Failed to determine column number"

set_font $(( reference_fontsize * reference_cols / target_cols ))
