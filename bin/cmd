#!/bin/sh
cmd=${1?\$1 needs to be command name}
scriptdir="$HOME"/.config/bin
script="$scriptdir/$cmd"

search() {
  IFS=:
  for p in $PATH ; do
    case "$p" in
    ($scriptdir) ;;
    (*) if test -x "$p/$1"; then
          echo "$p/$1";
          return;
        fi
    esac
  done
}

template() {
  old=$(search "$1")
  if test -n "$old"; then
    case "$(head -n 1 "$old")" in
    ("#!/bin/sh")
      cat "$old";;
    (*)
      printf '#!/bin/sh\nexec %s "$@"\n' "$old";;
    esac
  else
    printf '#!/bin/sh\n'
  fi
}

reference=$(mktemp)
template "$cmd" >"$reference"

test -e "$script" || cp "$reference" "$script"
chmod +x "$script"

${VISUAL:-vi} "$script"

# delete if equal to template or empty
if cmp -s "$reference" "$script" || ! test -s "$script"; then
  rm "$script"
fi

rm "$reference"
