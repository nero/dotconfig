#!/bin/sh

case "$(uname -s)" in
(Linux)
  test -e /proc/sys/kernel/tainted && test "$(cat /proc/sys/kernel/tainted)" -gt 0 && echo tainted kernel
  if test "$(stat -c "%i" /)" -gt 2; then
    echo namespaced environment
  else
   test -d "/lib/modules/$(uname -r)" || echo "kernel module version mismatch"
  fi
  if test -r /proc/pressure/cpu; then
    test "$(awk '/some/ {gsub(/avg[0-9]*=/,"");printf("%d",$2)}' /proc/pressure/cpu)" -gt 20 && echo cpu stall
    test "$(awk '/full/ {gsub(/avg[0-9]*=/,"");printf("%d",$2)}' /proc/pressure/memory)" -gt 20 && echo memory stall
  fi
  ;;
esac

# print free diskspace if less than 1GB
df -k -P "$HOME"|awk '/^\// {if ($4<10*1024*1024) {printf("%d MB available\n",$4/1024)}}'
